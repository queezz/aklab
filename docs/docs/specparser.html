<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>aklab.specparser API documentation</title>
<meta name="description" content="Horiba Jobin Yvon spectrometer, focal length=&#34;&#34;, with which_camera.
Script to read data?" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>aklab.specparser</code></h1>
</header>
<section id="section-intro">
<p>Horiba Jobin Yvon spectrometer, focal length="", with which_camera.
Script to read data?</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Horiba Jobin Yvon spectrometer, focal length=&#34;&#34;, with which_camera.
Script to read data?
&#34;&#34;&#34;
import matplotlib.pyplot as plt
import matplotlib as mpl
import xarray as xr
import pandas as pd
import numpy as np
from os.path import join, exists

import aklab.mpls as akmp


class Spectrometer:
    def __init__(self, bpath=&#34;&#34;, disp=True, old=None, subtract=False, bgpath=None):

        from os import listdir
        from datetime import date

        self.bpath = bpath
        self.date = date.today()
        self.wavelength = 0
        self.old = old
        self.balmers = np.array([656.279, 486.135, 434.047])  # Halph, Hbeta, Hgammma

        if self.old:  # for analysis befor 2021/11/21
            self.rs = np.array([22000, 60570, 70730])
        else:
            self.rs = np.array([84815, 123253, 133373])

        self.fun = np.poly1d(np.polyfit(self.rs, self.balmers, 2))
        # self.basefiles = listdir(bpath)

        self.fp_list = []
        for i in range(len(listdir(bpath))):
            rotation = int(listdir(bpath)[i].split(&#34;-&#34;)[1])
            self.fp_list.append([join(bpath, listdir(bpath)[i]), rotation])
        self.fp_df = pd.DataFrame(self.fp_list, columns=[&#34;filepath&#34;, &#34;rotation&#34;])

        self.data_list = []
        list_id = []

        for i in listdir(bpath):  # convert all nc files in basepath to np.ndarray
            self.data_list.append(self.convert_nc(i))
            list_id.append(i)

        print(pd.DataFrame(list_id, columns=[&#34;index of data_list&#34;]))

        if disp:
            for i in self.fp_list:
                if subtract:
                    self.display_nc(self.sub_bg(i[0], bgpath))
                else:
                    self.display_nc(i[0])
                plt.title(f&#34;{i[0]}&#34;)

    def rotationis(self, rotation):
        if self.old:
            if rotation == 400000:
                wavelength = self.balmers[0]
            elif rotation == 585000:
                wavelength = self.balmers[1]
            elif rotation == 635000:
                wavelength = self.balmers[2]
            else:
                wavelength = 0
        else:
            if rotation == 415000:
                wavelength = self.balmers[0]
            elif rotation == 600000:
                wavelength = self.balmers[1]
            elif rotation == 650000:
                wavelength = self.balmers[2]
            else:
                wavelength = 0

        return wavelength

    def get_rot(self, fp):
        if iscd(fp):
            return int(fp.split(&#34;-&#34;)[1])
        elif exists(fp):
            split = &#34;\\&#34;
            if len(fp.split(split)) == 1:
                split = &#34;/&#34;
            return int(fp.split(split)[-1].split(&#34;-&#34;)[1])
        else:
            print(&#34;File does not exist&#34;)
            return

    def convert_nc(self, fp):
        if iscd(fp):
            fp = join(self.bpath, fp)
            if not exists(fp):
                print(&#34;File does not exist&#34;)
                return
        rotation = self.get_rot(fp)
        data = np.array(xr.open_dataset(fp).to_array()[0].sum(axis=0)).astype(np.float64)
        if self.old:
            data = np.stack([data, self.fun(np.arange(2048) + (rotation - 300000) * 1044.5 / 5000)], 0)
        else:
            data = np.stack([data, self.fun(np.arange(2048) + (rotation - 10000) * 1039.67 / 5000)], 0)

        return data

    def display_nc(
        self,
        fp,
        xlim=None,
        ylim=None,
        disp=True,
        subplot=None,
        fig=None,
        style=False,
        yoffset=None,
        title=None,
        line=None,
    ):
        if type(fp) == str:  # when row nc data is selected
            data = self.convert_nc(fp)
        elif type(fp) != np.ndarray:
            return &#39;please insert fp=&#34;row nc data&#34; or data=&#34;converted nc data&#34;&#39;
        else:
            data = fp
        akmp.font_setup(size=28)
        if disp:
            if subplot:
                ax = fig.add_subplot(
                    subplot[0], subplot[1], subplot[2], xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;
                )
            else:
                fig = plt.figure(figsize=(16, 9), dpi=50)
                ax = fig.add_subplot(1, 1, 1, xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;)
            if line:
                ax.axvline(line, c=&#34;r&#34;)
            if style:
                a = r&#34;${\rm Intensity}{\ }{\rm (\times 10^&#34;
                b = f&#34;{yoffset}&#34;
                c = r&#34;{\ }arb.unit)}$&#34;
                ax.set_ylabel(a + b + c)
                ax.set_ylabel(r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;)
                ax.yaxis.offsetText.set_fontsize(0)
                ax.plot(data[1], data[0] / max(data[0]), &#34;.-&#34;, c=&#34;k&#34;)
            else:
                ax.set_ylabel(r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;)
                ax.plot(data[1], data[0], &#34;.-&#34;, c=&#34;k&#34;)
                ax.set_ylim(top=max(data[0]) * 1.2)

            ax.set_title(title)
            # ax.legend(bbox_to_anchor=(1, 1), loc=&#39;upper right&#39;, borderaxespad=0, fontsize=16)
            akmp.ticks_visual(ax)
            akmp.grid_visual(ax)
            if xlim:
                ax.set_xlim(xlim)
            if ylim:
                ax.set_ylim(ylim)

    def subtract_background(self, fp, disp=True, bp=None):
        split = &#34;\\&#34;
        from os.path import join

        if not bp:
            bp = join(&#34;../../data/spectrometer/20211208&#34;, &#34;background-420000-10000.0ms-.nc&#34;)
        image = self.convert_nc(fp)
        back = self.convert_nc(bp)
        sub = image
        for i in range(len(image[0])):
            sub[0][i] = image[0][i] - back[0][i]
        if disp:
            fig = plt.figure(figsize=(16, 9), dpi=50)
            ax = fig.add_subplot(
                1,
                1,
                1,
                xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
                ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
            )
            ax.plot(sub[1], sub[0], &#34;.-&#34;)
            # ax.legend(bbox_to_anchor=(1, 1), loc=&#39;upper right&#39;, borderaxespad=0, fontsize=16)
            akmp.ticks_visual(ax)
            akmp.grid_visual(ax)
        return sub

    def sub_bg(self, fp, bgpath):
        import os

        rot = fp.split(&#34;-&#34;)[1]
        op = fp.split(&#34;-&#34;)[4]
        ls = [i for i in os.listdir(bgpath) if rot in i]
        ls = [i for i in ls if &#34;-&#34; + op + &#34;-&#34; in i]
        if ls == []:
            ls = [os.listdir(bgpath)]
        return self.subtract_background(fp, disp=False, bp=os.path.join(bgpath, ls[0]))

        # def display_nc(self, name, xlimit=0, ylimit=0, disp=0, topng=False, topdf=False):
        import re
        from os.path import join

        numbers = re.findall(r&#34;\d+&#34;, name)
        rotation_number = []
        for i in range(len(numbers)):
            if int(numbers[i]) // 5000 != 0:
                rotation_number.append(numbers[i])
        self.rotationis(rotation_number[0])

        fp = join(self.bpath, name)
        data = np.array(xr.open_dataset(fp).to_array()[0].sum(axis=0)).astype(np.float64)
        data = np.stack([data, self.fun(np.arange(2048) + (self.rotation - 300000) * 1044.5 / 5000)], 0)
        if xlimit == 0:
            x = data[1]
            y = data[0]
        else:
            n = self.idx_of_the_nearest(data[1], xlimit)
            x = data[1][n[1] : n[0]]
            y = data[0][n[1] : n[0]]

        if disp == 0:
            # xdivision = 200
            font_setup(size=28)
            fig = plt.figure(figsize=(16, 9), dpi=50)
            ax = fig.add_subplot(
                1,
                1,
                1,
                xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
                ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
            )
            ax.plot(data[1], data[0], &#34;.-&#34;, label=name)
            ax.legend(bbox_to_anchor=(1, 1), loc=&#34;upper right&#34;, borderaxespad=0, fontsize=16)
            # ax.xaxis.set_major_locator(mpl.ticker.MultipleLocator(xdivision))
            # ax.yaxis.set_major_formatter(mpl.ticker.PercentFormatter((max(y) - (min(y)))*100, decimals=1, symbol=&#39;&#39;))
            ticks_visual(ax)
            grid_visual(ax)
            if xlimit != 0:
                plt.xlim(xlimit)
            if ylimit != 0:
                plt.ylim(ylimit)
            else:
                # plt.ylim((min(y)), (max(y) * 1.1))
                pass

            if topng:
                fig.savefig(join(self.ppath, &#34;&#34;))

        return data

        # def display_nc_all(self):
        from re import findall
        from os import listdir

        files = listdir(self.bpath)
        for file_name in files:
            numbers = findall(r&#34;\d+&#34;, file_name)
            rotation_number = []
            for i in range(len(numbers)):
                if int(numbers[i]) // 5000 != 0:
                    rotation_number.append(numbers[i])
            self.rotationis(rotation_number[0])
            self.display_nc(file_name)

    def display_data(self, data, xlimit=None, ylimit=None, disp=True):
        if not xlimit:
            x = data[1]
            y = data[0]
        else:
            n = self.idx_of_the_nearest(data[1], xlimit)
            x = data[1][n[1] : n[0]]
            y = data[0][n[1] : n[0]]

        if disp:
            # xdivision = 200
            akmp.font_setup(size=28)
            fig = plt.figure(figsize=(16, 9), dpi=50)
            ax = fig.add_subplot(
                1,
                1,
                1,
                xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
                ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
            )
            ax.plot(data[1], data[0], &#34;.-&#34;)
            # ax.legend(bbox_to_anchor=(1, 1), loc=&#39;upper right&#39;, borderaxespad=0, fontsize=28)
            # ax.xaxis.set_major_locator(mpl.ticker.MultipleLocator(xdivision))
            ax.yaxis.set_major_formatter(
                mpl.ticker.PercentFormatter((max(y) - (min(y))) * 100, decimals=1, symbol=&#34;&#34;)
            )
            akmp.ticks_visual(ax)
            akmp.grid_visual(ax)
            if xlimit:
                plt.xlim(xlimit)
            if ylimit:
                plt.ylim(ylimit)
            else:
                plt.ylim((min(y)), (max(y) * 1.1))

        return data

    def calcgauss(self, data, rangeis, num_gauss=1, par_enable=True):
        n = self.idx_of_the_nearest(data[1], rangeis)
        x = data[1][n[1] : n[0]]
        y = data[0][n[1] : n[0]]
        from lmfit.models import GaussianModel, ConstantModel

        if num_gauss == 1:
            mod = ConstantModel() + GaussianModel()
            params = mod.make_params()
            par_val = {
                &#34;c&#34;: min(y),
                &#34;center&#34;: x[np.argmax(y)],
                &#34;sigma&#34;: 0.005,
                &#34;amplitude&#34;: (max(y) - min(y)) / 200,
            }
            par_vary = {
                &#34;c&#34;: par_enable,
                &#34;center&#34;: par_enable,
                &#34;sigma&#34;: par_enable,
                &#34;amplitude&#34;: par_enable,
            }
        elif num_gauss == 2:
            mod = ConstantModel() + GaussianModel(prefix=&#34;gauss1_&#34;) + GaussianModel(prefix=&#34;gauss2_&#34;)
            params = mod.make_params()
            par_val = {
                &#34;c&#34;: min(y),
                &#34;gauss1_center&#34;: x[np.argmax(y)],
                &#34;gauss1_sigma&#34;: 0.005,
                &#34;gauss1_amplitude&#34;: (max(y) - min(y)) / 200,
                &#34;gauss2_center&#34;: x[np.argmax(y)],
                # &#39;gauss2_center&#39; : data[1][np.argmax(data[0])],
                &#34;gauss2_sigma&#34;: 0.01,
                &#34;gauss2_amplitude&#34;: (max(y) - min(y)) / 400,
            }
            par_vary = {
                &#34;c&#34;: par_enable,
                &#34;gauss1_center&#34;: par_enable,
                &#34;gauss1_sigma&#34;: par_enable,
                &#34;gauss1_amplitude&#34;: par_enable,
                &#34;gauss2_center&#34;: par_enable,
                &#34;gauss2_sigma&#34;: par_enable,
                &#34;gauss2_amplitude&#34;: par_enable,
            }
        for name in mod.param_names:
            params[name].set(value=par_val[name], vary=par_vary[name])  # 初期値  # パラメータを動かすかどうか
        self.out = mod.fit(data=y, x=x, params=params)
        return self.out, max(y)

    def gaussian(self, x, amp, cen, wid):
        &#34;&#34;&#34;1-d gaussian: gaussian(x, amp, cen, wid)&#34;&#34;&#34;
        return (amp / (np.sqrt(2 * np.pi) * wid)) * np.exp(-((x - cen) ** 2) / (2 * wid ** 2))

    def display_gaussian(
        self, data, out, rangeis, xlimit=None, ylimit=None, num_gauss=1, subplot=None, fig=None, fontsize=28
    ):
        x2 = np.linspace(data[1][0], data[1][-1], 10000)
        n = self.idx_of_the_nearest(data[1], rangeis)
        x = data[1][n[1] : n[0]]
        y = data[0][n[1] : n[0]]

        akmp.font_setup(size=fontsize)
        if subplot:
            ax = fig.add_subplot(
                subplot[0],
                subplot[1],
                subplot[2],
                xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
                ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
            )
        else:
            fig = plt.figure(figsize=(16, 9), dpi=50)
            ax = fig.add_subplot(
                1,
                1,
                1,
                xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
                ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
            )
        ax.plot(data[1], data[0] - out.best_values[&#34;c&#34;], &#34;o&#34;, label=r&#34;Data&#34;, c=&#34;k&#34;)
        if num_gauss == 1:
            ax.plot(
                x2,
                self.gaussian(
                    x2, out.best_values[&#34;amplitude&#34;], out.best_values[&#34;center&#34;], out.best_values[&#34;sigma&#34;]
                ),
                &#34;-&#34;,
                label=r&#34;Fitting&#34;,
                c=&#34;r&#34;,
            )
        elif num_gauss == 2:
            ax.plot(
                x2,
                self.gaussian(
                    x2,
                    out.best_values[&#34;gauss1_amplitude&#34;],
                    out.best_values[&#34;gauss1_center&#34;],
                    out.best_values[&#34;gauss1_sigma&#34;],
                ),
                &#34;-&#34;,
                label=r&#34;Low temperature&#34;,
                c=&#34;C1&#34;,
            )
            ax.plot(
                x2,
                self.gaussian(
                    x2,
                    out.best_values[&#34;gauss2_amplitude&#34;],
                    out.best_values[&#34;gauss2_center&#34;],
                    out.best_values[&#34;gauss2_sigma&#34;],
                ),
                &#34;-&#34;,
                label=r&#34;High temperature&#34;,
                c=&#34;C2&#34;,
            )
            ax.plot(
                x2,
                self.gaussian(
                    x2,
                    out.best_values[&#34;gauss1_amplitude&#34;],
                    out.best_values[&#34;gauss1_center&#34;],
                    out.best_values[&#34;gauss1_sigma&#34;],
                )
                + self.gaussian(
                    x2,
                    out.best_values[&#34;gauss2_amplitude&#34;],
                    out.best_values[&#34;gauss2_center&#34;],
                    out.best_values[&#34;gauss2_sigma&#34;],
                ),
                &#34;-&#34;,
                label=r&#34;Summation&#34;,
                c=&#34;r&#34;,
            )
        ax.legend(bbox_to_anchor=(1, 1), loc=&#34;upper right&#34;, borderaxespad=0)
        ax.xaxis.set_major_locator(mpl.ticker.LinearLocator(3))
        ax.yaxis.set_major_formatter(
            mpl.ticker.PercentFormatter((max(y) - out.best_values[&#34;c&#34;]) * 100, decimals=1, symbol=&#34;&#34;)
        )
        akmp.ticks_visual(ax)
        akmp.grid_visual(ax)
        if xlimit:
            plt.xlim(xlimit)
        if ylimit:
            plt.ylim(ylimit)
        else:
            plt.ylim((min(y)) - out.best_values[&#34;c&#34;], (max(y) - out.best_values[&#34;c&#34;]) * 1.1)

    def calc_fwhm(
        self,
        fp,
        rangeis=None,
        xlimit=None,
        ylimit=0,
        num_gauss=1,
        disp=True,
        subplot=None,
        fig=None,
        fontsize=28,
    ):
        if type(fp) == str:  # when row nc data is selected
            data = self.convert_nc(fp)
        elif type(fp) != np.ndarray:
            return &#39;please insert fp=&#34;row nc data&#34; or data=&#34;converted nc data&#34;&#39;
        else:
            data = fp

        if xlimit is None:
            xlimit = rangeis
        out, intencity = self.calcgauss(data, rangeis, num_gauss=num_gauss)
        if disp:
            self.display_gaussian(
                data,
                out,
                rangeis=rangeis,
                xlimit=xlimit,
                ylimit=ylimit,
                num_gauss=num_gauss,
                subplot=subplot,
                fig=fig,
                fontsize=fontsize,
            )
        if num_gauss == 1:
            if type(out.params[&#34;sigma&#34;].stderr) == type(None):
                out.params[&#34;sigma&#34;].stderr = 0
            sigma = [[out.params[&#34;sigma&#34;].value, out.params[&#34;sigma&#34;].stderr]]
            fwhm = 2 * np.array(sigma) * np.sqrt(2 * np.log(2))
            print(f&#34;FWHM {fwhm[0][0]:.4f} +- {fwhm[0][1]:.4f} nm   intencity {intencity}   &#34;, end=&#34;&#34;)
        elif num_gauss == 2:
            if type(out.params[&#34;gauss1_sigma&#34;].stderr) == type(None):
                out.params[&#34;gauss1_sigma&#34;].stderr = 0
            if type(out.params[&#34;gauss2_sigma&#34;].stderr) == type(None):
                out.params[&#34;gauss2_sigma&#34;].stderr = 0
            self.sigma = [
                [out.params[&#34;gauss1_sigma&#34;].value, out.params[&#34;gauss1_sigma&#34;].stderr],
                [out.params[&#34;gauss2_sigma&#34;].value, out.params[&#34;gauss2_sigma&#34;].stderr],
            ]
            fwhm = 2 * np.array(self.sigma) * np.sqrt(2 * np.log(2))
            print(
                f&#34;FWHM {fwhm[0][0]:.4f} +- {fwhm[0][1]:.4f} nm and {fwhm[1][0]:.4f} +- {fwhm[1][1]:.4f} nm intencity {intencity}   &#34;,
                end=&#34;&#34;,
            )
        return fwhm

    def subtract_nc(self, name1, name2):
        data_back = self.convert_nc(name2)
        data_sig = self.convert_nc(name1)

        for i in range(len(data_sig[0])):
            data_sig[0][i] = data_sig[0][i] - data_back[0][i]

        return data_sig

    # def calc_temperature(self, fwhm1, fwhm2, explain = &#34;&#34;,A=1.0079):
    #     if len(fwhm1)==2:
    #         deltalam = [(fwhm1[0][0]**2 - fwhm2**2)**0.5, (fwhm1[0][1]**2 - fwhm2**2)**0.5]
    #         atom_temperature = [(deltalam[0] / (7.16e-7 * self.wavelength))**2 * A, (deltalam[1] / (7.16e-7 * self.wavelength))**2 * A]
    #         print(f&#39;{atom_temperature[0]:.2f} K and {atom_temperature[1]:.2f} K   {explain}&#39;)
    #     else :
    #         deltalam = (fwhm1**2 - fwhm2**2)**0.5
    #         atom_temperature = (deltalam / (7.16e-7 * self.wavelength))**2 * A
    #         print(f&#39;{atom_temperature:.2f} K    {explain}&#39;)
    #     return atom_temperature

    def calc_temperature(self, fwhm1, fwhm2, explain=&#34;&#34;, A=1.0079):
        if len(fwhm1) == 1:
            fwhm = np.array([fwhm1[0][0], fwhm1[0][0] + fwhm1[0][1], fwhm1[0][0] - fwhm1[0][1]])
            deltalam = (fwhm ** 2 - fwhm2[0][0] ** 2) ** 0.5
            atom_temperature = (deltalam / (7.16e-7 * self.wavelength)) ** 2 * A
            print(
                f&#34;{atom_temperature[0]:.2f} +{atom_temperature[1]-atom_temperature[0]} -{atom_temperature[0]-atom_temperature[2]}  K   {explain}&#34;
            )
        else:
            fwhm = np.array(
                [
                    [fwhm1[0][0], fwhm1[0][0] + fwhm1[0][1], fwhm1[0][0] - fwhm1[0][1]],
                    [fwhm1[1][0], fwhm1[1][0] + fwhm1[1][1], fwhm1[1][0] - fwhm1[1][1]],
                ]
            )
            deltalam = (fwhm ** 2 - fwhm2[0][0] ** 2) ** 0.5
            atom_temperature = (deltalam / (7.16e-7 * self.wavelength)) ** 2 * A
            print(
                f&#34;{atom_temperature[0][0]:.2f} +{atom_temperature[0][1]-atom_temperature[0][0]} -{atom_temperature[0][0]-atom_temperature[0][2]} K and {atom_temperature[1][0]:.2f} +{atom_temperature[1][1]-atom_temperature[1][0]} -{atom_temperature[1][0]-atom_temperature[1][2]} K   {explain}&#34;
            )

    def idx_of_the_nearest(self, data, value):
        if type(value) == float:
            idx = np.argmin(np.abs(np.array(data) - value))
            # print(np.abs(np.array(data) - value))
            return idx
        if type(value) == list:
            idx = [None] * len(value)
            for i in range(len(value)):
                idx[i] = np.argmin(np.abs(np.array(data) - value[i]))
                # idx[i] = [value[i], np.argmin(np.abs(np.array(data) - value[i]))] #としてもよい
                # print(np.abs(np.array(data) - value[i]))
            return idx


def iscd(fp):
    split1 = &#34;\\&#34;
    split2 = &#34;/&#34;
    return len(fp.split(split1)) == 1 and len(fp.split(split2)) == 1</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="aklab.specparser.iscd"><code class="name flex">
<span>def <span class="ident">iscd</span></span>(<span>fp)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def iscd(fp):
    split1 = &#34;\\&#34;
    split2 = &#34;/&#34;
    return len(fp.split(split1)) == 1 and len(fp.split(split2)) == 1</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="aklab.specparser.Spectrometer"><code class="flex name class">
<span>class <span class="ident">Spectrometer</span></span>
<span>(</span><span>bpath='', disp=True, old=None, subtract=False, bgpath=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Spectrometer:
    def __init__(self, bpath=&#34;&#34;, disp=True, old=None, subtract=False, bgpath=None):

        from os import listdir
        from datetime import date

        self.bpath = bpath
        self.date = date.today()
        self.wavelength = 0
        self.old = old
        self.balmers = np.array([656.279, 486.135, 434.047])  # Halph, Hbeta, Hgammma

        if self.old:  # for analysis befor 2021/11/21
            self.rs = np.array([22000, 60570, 70730])
        else:
            self.rs = np.array([84815, 123253, 133373])

        self.fun = np.poly1d(np.polyfit(self.rs, self.balmers, 2))
        # self.basefiles = listdir(bpath)

        self.fp_list = []
        for i in range(len(listdir(bpath))):
            rotation = int(listdir(bpath)[i].split(&#34;-&#34;)[1])
            self.fp_list.append([join(bpath, listdir(bpath)[i]), rotation])
        self.fp_df = pd.DataFrame(self.fp_list, columns=[&#34;filepath&#34;, &#34;rotation&#34;])

        self.data_list = []
        list_id = []

        for i in listdir(bpath):  # convert all nc files in basepath to np.ndarray
            self.data_list.append(self.convert_nc(i))
            list_id.append(i)

        print(pd.DataFrame(list_id, columns=[&#34;index of data_list&#34;]))

        if disp:
            for i in self.fp_list:
                if subtract:
                    self.display_nc(self.sub_bg(i[0], bgpath))
                else:
                    self.display_nc(i[0])
                plt.title(f&#34;{i[0]}&#34;)

    def rotationis(self, rotation):
        if self.old:
            if rotation == 400000:
                wavelength = self.balmers[0]
            elif rotation == 585000:
                wavelength = self.balmers[1]
            elif rotation == 635000:
                wavelength = self.balmers[2]
            else:
                wavelength = 0
        else:
            if rotation == 415000:
                wavelength = self.balmers[0]
            elif rotation == 600000:
                wavelength = self.balmers[1]
            elif rotation == 650000:
                wavelength = self.balmers[2]
            else:
                wavelength = 0

        return wavelength

    def get_rot(self, fp):
        if iscd(fp):
            return int(fp.split(&#34;-&#34;)[1])
        elif exists(fp):
            split = &#34;\\&#34;
            if len(fp.split(split)) == 1:
                split = &#34;/&#34;
            return int(fp.split(split)[-1].split(&#34;-&#34;)[1])
        else:
            print(&#34;File does not exist&#34;)
            return

    def convert_nc(self, fp):
        if iscd(fp):
            fp = join(self.bpath, fp)
            if not exists(fp):
                print(&#34;File does not exist&#34;)
                return
        rotation = self.get_rot(fp)
        data = np.array(xr.open_dataset(fp).to_array()[0].sum(axis=0)).astype(np.float64)
        if self.old:
            data = np.stack([data, self.fun(np.arange(2048) + (rotation - 300000) * 1044.5 / 5000)], 0)
        else:
            data = np.stack([data, self.fun(np.arange(2048) + (rotation - 10000) * 1039.67 / 5000)], 0)

        return data

    def display_nc(
        self,
        fp,
        xlim=None,
        ylim=None,
        disp=True,
        subplot=None,
        fig=None,
        style=False,
        yoffset=None,
        title=None,
        line=None,
    ):
        if type(fp) == str:  # when row nc data is selected
            data = self.convert_nc(fp)
        elif type(fp) != np.ndarray:
            return &#39;please insert fp=&#34;row nc data&#34; or data=&#34;converted nc data&#34;&#39;
        else:
            data = fp
        akmp.font_setup(size=28)
        if disp:
            if subplot:
                ax = fig.add_subplot(
                    subplot[0], subplot[1], subplot[2], xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;
                )
            else:
                fig = plt.figure(figsize=(16, 9), dpi=50)
                ax = fig.add_subplot(1, 1, 1, xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;)
            if line:
                ax.axvline(line, c=&#34;r&#34;)
            if style:
                a = r&#34;${\rm Intensity}{\ }{\rm (\times 10^&#34;
                b = f&#34;{yoffset}&#34;
                c = r&#34;{\ }arb.unit)}$&#34;
                ax.set_ylabel(a + b + c)
                ax.set_ylabel(r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;)
                ax.yaxis.offsetText.set_fontsize(0)
                ax.plot(data[1], data[0] / max(data[0]), &#34;.-&#34;, c=&#34;k&#34;)
            else:
                ax.set_ylabel(r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;)
                ax.plot(data[1], data[0], &#34;.-&#34;, c=&#34;k&#34;)
                ax.set_ylim(top=max(data[0]) * 1.2)

            ax.set_title(title)
            # ax.legend(bbox_to_anchor=(1, 1), loc=&#39;upper right&#39;, borderaxespad=0, fontsize=16)
            akmp.ticks_visual(ax)
            akmp.grid_visual(ax)
            if xlim:
                ax.set_xlim(xlim)
            if ylim:
                ax.set_ylim(ylim)

    def subtract_background(self, fp, disp=True, bp=None):
        split = &#34;\\&#34;
        from os.path import join

        if not bp:
            bp = join(&#34;../../data/spectrometer/20211208&#34;, &#34;background-420000-10000.0ms-.nc&#34;)
        image = self.convert_nc(fp)
        back = self.convert_nc(bp)
        sub = image
        for i in range(len(image[0])):
            sub[0][i] = image[0][i] - back[0][i]
        if disp:
            fig = plt.figure(figsize=(16, 9), dpi=50)
            ax = fig.add_subplot(
                1,
                1,
                1,
                xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
                ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
            )
            ax.plot(sub[1], sub[0], &#34;.-&#34;)
            # ax.legend(bbox_to_anchor=(1, 1), loc=&#39;upper right&#39;, borderaxespad=0, fontsize=16)
            akmp.ticks_visual(ax)
            akmp.grid_visual(ax)
        return sub

    def sub_bg(self, fp, bgpath):
        import os

        rot = fp.split(&#34;-&#34;)[1]
        op = fp.split(&#34;-&#34;)[4]
        ls = [i for i in os.listdir(bgpath) if rot in i]
        ls = [i for i in ls if &#34;-&#34; + op + &#34;-&#34; in i]
        if ls == []:
            ls = [os.listdir(bgpath)]
        return self.subtract_background(fp, disp=False, bp=os.path.join(bgpath, ls[0]))

        # def display_nc(self, name, xlimit=0, ylimit=0, disp=0, topng=False, topdf=False):
        import re
        from os.path import join

        numbers = re.findall(r&#34;\d+&#34;, name)
        rotation_number = []
        for i in range(len(numbers)):
            if int(numbers[i]) // 5000 != 0:
                rotation_number.append(numbers[i])
        self.rotationis(rotation_number[0])

        fp = join(self.bpath, name)
        data = np.array(xr.open_dataset(fp).to_array()[0].sum(axis=0)).astype(np.float64)
        data = np.stack([data, self.fun(np.arange(2048) + (self.rotation - 300000) * 1044.5 / 5000)], 0)
        if xlimit == 0:
            x = data[1]
            y = data[0]
        else:
            n = self.idx_of_the_nearest(data[1], xlimit)
            x = data[1][n[1] : n[0]]
            y = data[0][n[1] : n[0]]

        if disp == 0:
            # xdivision = 200
            font_setup(size=28)
            fig = plt.figure(figsize=(16, 9), dpi=50)
            ax = fig.add_subplot(
                1,
                1,
                1,
                xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
                ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
            )
            ax.plot(data[1], data[0], &#34;.-&#34;, label=name)
            ax.legend(bbox_to_anchor=(1, 1), loc=&#34;upper right&#34;, borderaxespad=0, fontsize=16)
            # ax.xaxis.set_major_locator(mpl.ticker.MultipleLocator(xdivision))
            # ax.yaxis.set_major_formatter(mpl.ticker.PercentFormatter((max(y) - (min(y)))*100, decimals=1, symbol=&#39;&#39;))
            ticks_visual(ax)
            grid_visual(ax)
            if xlimit != 0:
                plt.xlim(xlimit)
            if ylimit != 0:
                plt.ylim(ylimit)
            else:
                # plt.ylim((min(y)), (max(y) * 1.1))
                pass

            if topng:
                fig.savefig(join(self.ppath, &#34;&#34;))

        return data

        # def display_nc_all(self):
        from re import findall
        from os import listdir

        files = listdir(self.bpath)
        for file_name in files:
            numbers = findall(r&#34;\d+&#34;, file_name)
            rotation_number = []
            for i in range(len(numbers)):
                if int(numbers[i]) // 5000 != 0:
                    rotation_number.append(numbers[i])
            self.rotationis(rotation_number[0])
            self.display_nc(file_name)

    def display_data(self, data, xlimit=None, ylimit=None, disp=True):
        if not xlimit:
            x = data[1]
            y = data[0]
        else:
            n = self.idx_of_the_nearest(data[1], xlimit)
            x = data[1][n[1] : n[0]]
            y = data[0][n[1] : n[0]]

        if disp:
            # xdivision = 200
            akmp.font_setup(size=28)
            fig = plt.figure(figsize=(16, 9), dpi=50)
            ax = fig.add_subplot(
                1,
                1,
                1,
                xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
                ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
            )
            ax.plot(data[1], data[0], &#34;.-&#34;)
            # ax.legend(bbox_to_anchor=(1, 1), loc=&#39;upper right&#39;, borderaxespad=0, fontsize=28)
            # ax.xaxis.set_major_locator(mpl.ticker.MultipleLocator(xdivision))
            ax.yaxis.set_major_formatter(
                mpl.ticker.PercentFormatter((max(y) - (min(y))) * 100, decimals=1, symbol=&#34;&#34;)
            )
            akmp.ticks_visual(ax)
            akmp.grid_visual(ax)
            if xlimit:
                plt.xlim(xlimit)
            if ylimit:
                plt.ylim(ylimit)
            else:
                plt.ylim((min(y)), (max(y) * 1.1))

        return data

    def calcgauss(self, data, rangeis, num_gauss=1, par_enable=True):
        n = self.idx_of_the_nearest(data[1], rangeis)
        x = data[1][n[1] : n[0]]
        y = data[0][n[1] : n[0]]
        from lmfit.models import GaussianModel, ConstantModel

        if num_gauss == 1:
            mod = ConstantModel() + GaussianModel()
            params = mod.make_params()
            par_val = {
                &#34;c&#34;: min(y),
                &#34;center&#34;: x[np.argmax(y)],
                &#34;sigma&#34;: 0.005,
                &#34;amplitude&#34;: (max(y) - min(y)) / 200,
            }
            par_vary = {
                &#34;c&#34;: par_enable,
                &#34;center&#34;: par_enable,
                &#34;sigma&#34;: par_enable,
                &#34;amplitude&#34;: par_enable,
            }
        elif num_gauss == 2:
            mod = ConstantModel() + GaussianModel(prefix=&#34;gauss1_&#34;) + GaussianModel(prefix=&#34;gauss2_&#34;)
            params = mod.make_params()
            par_val = {
                &#34;c&#34;: min(y),
                &#34;gauss1_center&#34;: x[np.argmax(y)],
                &#34;gauss1_sigma&#34;: 0.005,
                &#34;gauss1_amplitude&#34;: (max(y) - min(y)) / 200,
                &#34;gauss2_center&#34;: x[np.argmax(y)],
                # &#39;gauss2_center&#39; : data[1][np.argmax(data[0])],
                &#34;gauss2_sigma&#34;: 0.01,
                &#34;gauss2_amplitude&#34;: (max(y) - min(y)) / 400,
            }
            par_vary = {
                &#34;c&#34;: par_enable,
                &#34;gauss1_center&#34;: par_enable,
                &#34;gauss1_sigma&#34;: par_enable,
                &#34;gauss1_amplitude&#34;: par_enable,
                &#34;gauss2_center&#34;: par_enable,
                &#34;gauss2_sigma&#34;: par_enable,
                &#34;gauss2_amplitude&#34;: par_enable,
            }
        for name in mod.param_names:
            params[name].set(value=par_val[name], vary=par_vary[name])  # 初期値  # パラメータを動かすかどうか
        self.out = mod.fit(data=y, x=x, params=params)
        return self.out, max(y)

    def gaussian(self, x, amp, cen, wid):
        &#34;&#34;&#34;1-d gaussian: gaussian(x, amp, cen, wid)&#34;&#34;&#34;
        return (amp / (np.sqrt(2 * np.pi) * wid)) * np.exp(-((x - cen) ** 2) / (2 * wid ** 2))

    def display_gaussian(
        self, data, out, rangeis, xlimit=None, ylimit=None, num_gauss=1, subplot=None, fig=None, fontsize=28
    ):
        x2 = np.linspace(data[1][0], data[1][-1], 10000)
        n = self.idx_of_the_nearest(data[1], rangeis)
        x = data[1][n[1] : n[0]]
        y = data[0][n[1] : n[0]]

        akmp.font_setup(size=fontsize)
        if subplot:
            ax = fig.add_subplot(
                subplot[0],
                subplot[1],
                subplot[2],
                xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
                ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
            )
        else:
            fig = plt.figure(figsize=(16, 9), dpi=50)
            ax = fig.add_subplot(
                1,
                1,
                1,
                xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
                ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
            )
        ax.plot(data[1], data[0] - out.best_values[&#34;c&#34;], &#34;o&#34;, label=r&#34;Data&#34;, c=&#34;k&#34;)
        if num_gauss == 1:
            ax.plot(
                x2,
                self.gaussian(
                    x2, out.best_values[&#34;amplitude&#34;], out.best_values[&#34;center&#34;], out.best_values[&#34;sigma&#34;]
                ),
                &#34;-&#34;,
                label=r&#34;Fitting&#34;,
                c=&#34;r&#34;,
            )
        elif num_gauss == 2:
            ax.plot(
                x2,
                self.gaussian(
                    x2,
                    out.best_values[&#34;gauss1_amplitude&#34;],
                    out.best_values[&#34;gauss1_center&#34;],
                    out.best_values[&#34;gauss1_sigma&#34;],
                ),
                &#34;-&#34;,
                label=r&#34;Low temperature&#34;,
                c=&#34;C1&#34;,
            )
            ax.plot(
                x2,
                self.gaussian(
                    x2,
                    out.best_values[&#34;gauss2_amplitude&#34;],
                    out.best_values[&#34;gauss2_center&#34;],
                    out.best_values[&#34;gauss2_sigma&#34;],
                ),
                &#34;-&#34;,
                label=r&#34;High temperature&#34;,
                c=&#34;C2&#34;,
            )
            ax.plot(
                x2,
                self.gaussian(
                    x2,
                    out.best_values[&#34;gauss1_amplitude&#34;],
                    out.best_values[&#34;gauss1_center&#34;],
                    out.best_values[&#34;gauss1_sigma&#34;],
                )
                + self.gaussian(
                    x2,
                    out.best_values[&#34;gauss2_amplitude&#34;],
                    out.best_values[&#34;gauss2_center&#34;],
                    out.best_values[&#34;gauss2_sigma&#34;],
                ),
                &#34;-&#34;,
                label=r&#34;Summation&#34;,
                c=&#34;r&#34;,
            )
        ax.legend(bbox_to_anchor=(1, 1), loc=&#34;upper right&#34;, borderaxespad=0)
        ax.xaxis.set_major_locator(mpl.ticker.LinearLocator(3))
        ax.yaxis.set_major_formatter(
            mpl.ticker.PercentFormatter((max(y) - out.best_values[&#34;c&#34;]) * 100, decimals=1, symbol=&#34;&#34;)
        )
        akmp.ticks_visual(ax)
        akmp.grid_visual(ax)
        if xlimit:
            plt.xlim(xlimit)
        if ylimit:
            plt.ylim(ylimit)
        else:
            plt.ylim((min(y)) - out.best_values[&#34;c&#34;], (max(y) - out.best_values[&#34;c&#34;]) * 1.1)

    def calc_fwhm(
        self,
        fp,
        rangeis=None,
        xlimit=None,
        ylimit=0,
        num_gauss=1,
        disp=True,
        subplot=None,
        fig=None,
        fontsize=28,
    ):
        if type(fp) == str:  # when row nc data is selected
            data = self.convert_nc(fp)
        elif type(fp) != np.ndarray:
            return &#39;please insert fp=&#34;row nc data&#34; or data=&#34;converted nc data&#34;&#39;
        else:
            data = fp

        if xlimit is None:
            xlimit = rangeis
        out, intencity = self.calcgauss(data, rangeis, num_gauss=num_gauss)
        if disp:
            self.display_gaussian(
                data,
                out,
                rangeis=rangeis,
                xlimit=xlimit,
                ylimit=ylimit,
                num_gauss=num_gauss,
                subplot=subplot,
                fig=fig,
                fontsize=fontsize,
            )
        if num_gauss == 1:
            if type(out.params[&#34;sigma&#34;].stderr) == type(None):
                out.params[&#34;sigma&#34;].stderr = 0
            sigma = [[out.params[&#34;sigma&#34;].value, out.params[&#34;sigma&#34;].stderr]]
            fwhm = 2 * np.array(sigma) * np.sqrt(2 * np.log(2))
            print(f&#34;FWHM {fwhm[0][0]:.4f} +- {fwhm[0][1]:.4f} nm   intencity {intencity}   &#34;, end=&#34;&#34;)
        elif num_gauss == 2:
            if type(out.params[&#34;gauss1_sigma&#34;].stderr) == type(None):
                out.params[&#34;gauss1_sigma&#34;].stderr = 0
            if type(out.params[&#34;gauss2_sigma&#34;].stderr) == type(None):
                out.params[&#34;gauss2_sigma&#34;].stderr = 0
            self.sigma = [
                [out.params[&#34;gauss1_sigma&#34;].value, out.params[&#34;gauss1_sigma&#34;].stderr],
                [out.params[&#34;gauss2_sigma&#34;].value, out.params[&#34;gauss2_sigma&#34;].stderr],
            ]
            fwhm = 2 * np.array(self.sigma) * np.sqrt(2 * np.log(2))
            print(
                f&#34;FWHM {fwhm[0][0]:.4f} +- {fwhm[0][1]:.4f} nm and {fwhm[1][0]:.4f} +- {fwhm[1][1]:.4f} nm intencity {intencity}   &#34;,
                end=&#34;&#34;,
            )
        return fwhm

    def subtract_nc(self, name1, name2):
        data_back = self.convert_nc(name2)
        data_sig = self.convert_nc(name1)

        for i in range(len(data_sig[0])):
            data_sig[0][i] = data_sig[0][i] - data_back[0][i]

        return data_sig

    # def calc_temperature(self, fwhm1, fwhm2, explain = &#34;&#34;,A=1.0079):
    #     if len(fwhm1)==2:
    #         deltalam = [(fwhm1[0][0]**2 - fwhm2**2)**0.5, (fwhm1[0][1]**2 - fwhm2**2)**0.5]
    #         atom_temperature = [(deltalam[0] / (7.16e-7 * self.wavelength))**2 * A, (deltalam[1] / (7.16e-7 * self.wavelength))**2 * A]
    #         print(f&#39;{atom_temperature[0]:.2f} K and {atom_temperature[1]:.2f} K   {explain}&#39;)
    #     else :
    #         deltalam = (fwhm1**2 - fwhm2**2)**0.5
    #         atom_temperature = (deltalam / (7.16e-7 * self.wavelength))**2 * A
    #         print(f&#39;{atom_temperature:.2f} K    {explain}&#39;)
    #     return atom_temperature

    def calc_temperature(self, fwhm1, fwhm2, explain=&#34;&#34;, A=1.0079):
        if len(fwhm1) == 1:
            fwhm = np.array([fwhm1[0][0], fwhm1[0][0] + fwhm1[0][1], fwhm1[0][0] - fwhm1[0][1]])
            deltalam = (fwhm ** 2 - fwhm2[0][0] ** 2) ** 0.5
            atom_temperature = (deltalam / (7.16e-7 * self.wavelength)) ** 2 * A
            print(
                f&#34;{atom_temperature[0]:.2f} +{atom_temperature[1]-atom_temperature[0]} -{atom_temperature[0]-atom_temperature[2]}  K   {explain}&#34;
            )
        else:
            fwhm = np.array(
                [
                    [fwhm1[0][0], fwhm1[0][0] + fwhm1[0][1], fwhm1[0][0] - fwhm1[0][1]],
                    [fwhm1[1][0], fwhm1[1][0] + fwhm1[1][1], fwhm1[1][0] - fwhm1[1][1]],
                ]
            )
            deltalam = (fwhm ** 2 - fwhm2[0][0] ** 2) ** 0.5
            atom_temperature = (deltalam / (7.16e-7 * self.wavelength)) ** 2 * A
            print(
                f&#34;{atom_temperature[0][0]:.2f} +{atom_temperature[0][1]-atom_temperature[0][0]} -{atom_temperature[0][0]-atom_temperature[0][2]} K and {atom_temperature[1][0]:.2f} +{atom_temperature[1][1]-atom_temperature[1][0]} -{atom_temperature[1][0]-atom_temperature[1][2]} K   {explain}&#34;
            )

    def idx_of_the_nearest(self, data, value):
        if type(value) == float:
            idx = np.argmin(np.abs(np.array(data) - value))
            # print(np.abs(np.array(data) - value))
            return idx
        if type(value) == list:
            idx = [None] * len(value)
            for i in range(len(value)):
                idx[i] = np.argmin(np.abs(np.array(data) - value[i]))
                # idx[i] = [value[i], np.argmin(np.abs(np.array(data) - value[i]))] #としてもよい
                # print(np.abs(np.array(data) - value[i]))
            return idx</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="aklab.specparser.Spectrometer.calc_fwhm"><code class="name flex">
<span>def <span class="ident">calc_fwhm</span></span>(<span>self, fp, rangeis=None, xlimit=None, ylimit=0, num_gauss=1, disp=True, subplot=None, fig=None, fontsize=28)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def calc_fwhm(
    self,
    fp,
    rangeis=None,
    xlimit=None,
    ylimit=0,
    num_gauss=1,
    disp=True,
    subplot=None,
    fig=None,
    fontsize=28,
):
    if type(fp) == str:  # when row nc data is selected
        data = self.convert_nc(fp)
    elif type(fp) != np.ndarray:
        return &#39;please insert fp=&#34;row nc data&#34; or data=&#34;converted nc data&#34;&#39;
    else:
        data = fp

    if xlimit is None:
        xlimit = rangeis
    out, intencity = self.calcgauss(data, rangeis, num_gauss=num_gauss)
    if disp:
        self.display_gaussian(
            data,
            out,
            rangeis=rangeis,
            xlimit=xlimit,
            ylimit=ylimit,
            num_gauss=num_gauss,
            subplot=subplot,
            fig=fig,
            fontsize=fontsize,
        )
    if num_gauss == 1:
        if type(out.params[&#34;sigma&#34;].stderr) == type(None):
            out.params[&#34;sigma&#34;].stderr = 0
        sigma = [[out.params[&#34;sigma&#34;].value, out.params[&#34;sigma&#34;].stderr]]
        fwhm = 2 * np.array(sigma) * np.sqrt(2 * np.log(2))
        print(f&#34;FWHM {fwhm[0][0]:.4f} +- {fwhm[0][1]:.4f} nm   intencity {intencity}   &#34;, end=&#34;&#34;)
    elif num_gauss == 2:
        if type(out.params[&#34;gauss1_sigma&#34;].stderr) == type(None):
            out.params[&#34;gauss1_sigma&#34;].stderr = 0
        if type(out.params[&#34;gauss2_sigma&#34;].stderr) == type(None):
            out.params[&#34;gauss2_sigma&#34;].stderr = 0
        self.sigma = [
            [out.params[&#34;gauss1_sigma&#34;].value, out.params[&#34;gauss1_sigma&#34;].stderr],
            [out.params[&#34;gauss2_sigma&#34;].value, out.params[&#34;gauss2_sigma&#34;].stderr],
        ]
        fwhm = 2 * np.array(self.sigma) * np.sqrt(2 * np.log(2))
        print(
            f&#34;FWHM {fwhm[0][0]:.4f} +- {fwhm[0][1]:.4f} nm and {fwhm[1][0]:.4f} +- {fwhm[1][1]:.4f} nm intencity {intencity}   &#34;,
            end=&#34;&#34;,
        )
    return fwhm</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.calc_temperature"><code class="name flex">
<span>def <span class="ident">calc_temperature</span></span>(<span>self, fwhm1, fwhm2, explain='', A=1.0079)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def calc_temperature(self, fwhm1, fwhm2, explain=&#34;&#34;, A=1.0079):
    if len(fwhm1) == 1:
        fwhm = np.array([fwhm1[0][0], fwhm1[0][0] + fwhm1[0][1], fwhm1[0][0] - fwhm1[0][1]])
        deltalam = (fwhm ** 2 - fwhm2[0][0] ** 2) ** 0.5
        atom_temperature = (deltalam / (7.16e-7 * self.wavelength)) ** 2 * A
        print(
            f&#34;{atom_temperature[0]:.2f} +{atom_temperature[1]-atom_temperature[0]} -{atom_temperature[0]-atom_temperature[2]}  K   {explain}&#34;
        )
    else:
        fwhm = np.array(
            [
                [fwhm1[0][0], fwhm1[0][0] + fwhm1[0][1], fwhm1[0][0] - fwhm1[0][1]],
                [fwhm1[1][0], fwhm1[1][0] + fwhm1[1][1], fwhm1[1][0] - fwhm1[1][1]],
            ]
        )
        deltalam = (fwhm ** 2 - fwhm2[0][0] ** 2) ** 0.5
        atom_temperature = (deltalam / (7.16e-7 * self.wavelength)) ** 2 * A
        print(
            f&#34;{atom_temperature[0][0]:.2f} +{atom_temperature[0][1]-atom_temperature[0][0]} -{atom_temperature[0][0]-atom_temperature[0][2]} K and {atom_temperature[1][0]:.2f} +{atom_temperature[1][1]-atom_temperature[1][0]} -{atom_temperature[1][0]-atom_temperature[1][2]} K   {explain}&#34;
        )</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.calcgauss"><code class="name flex">
<span>def <span class="ident">calcgauss</span></span>(<span>self, data, rangeis, num_gauss=1, par_enable=True)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def calcgauss(self, data, rangeis, num_gauss=1, par_enable=True):
    n = self.idx_of_the_nearest(data[1], rangeis)
    x = data[1][n[1] : n[0]]
    y = data[0][n[1] : n[0]]
    from lmfit.models import GaussianModel, ConstantModel

    if num_gauss == 1:
        mod = ConstantModel() + GaussianModel()
        params = mod.make_params()
        par_val = {
            &#34;c&#34;: min(y),
            &#34;center&#34;: x[np.argmax(y)],
            &#34;sigma&#34;: 0.005,
            &#34;amplitude&#34;: (max(y) - min(y)) / 200,
        }
        par_vary = {
            &#34;c&#34;: par_enable,
            &#34;center&#34;: par_enable,
            &#34;sigma&#34;: par_enable,
            &#34;amplitude&#34;: par_enable,
        }
    elif num_gauss == 2:
        mod = ConstantModel() + GaussianModel(prefix=&#34;gauss1_&#34;) + GaussianModel(prefix=&#34;gauss2_&#34;)
        params = mod.make_params()
        par_val = {
            &#34;c&#34;: min(y),
            &#34;gauss1_center&#34;: x[np.argmax(y)],
            &#34;gauss1_sigma&#34;: 0.005,
            &#34;gauss1_amplitude&#34;: (max(y) - min(y)) / 200,
            &#34;gauss2_center&#34;: x[np.argmax(y)],
            # &#39;gauss2_center&#39; : data[1][np.argmax(data[0])],
            &#34;gauss2_sigma&#34;: 0.01,
            &#34;gauss2_amplitude&#34;: (max(y) - min(y)) / 400,
        }
        par_vary = {
            &#34;c&#34;: par_enable,
            &#34;gauss1_center&#34;: par_enable,
            &#34;gauss1_sigma&#34;: par_enable,
            &#34;gauss1_amplitude&#34;: par_enable,
            &#34;gauss2_center&#34;: par_enable,
            &#34;gauss2_sigma&#34;: par_enable,
            &#34;gauss2_amplitude&#34;: par_enable,
        }
    for name in mod.param_names:
        params[name].set(value=par_val[name], vary=par_vary[name])  # 初期値  # パラメータを動かすかどうか
    self.out = mod.fit(data=y, x=x, params=params)
    return self.out, max(y)</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.convert_nc"><code class="name flex">
<span>def <span class="ident">convert_nc</span></span>(<span>self, fp)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def convert_nc(self, fp):
    if iscd(fp):
        fp = join(self.bpath, fp)
        if not exists(fp):
            print(&#34;File does not exist&#34;)
            return
    rotation = self.get_rot(fp)
    data = np.array(xr.open_dataset(fp).to_array()[0].sum(axis=0)).astype(np.float64)
    if self.old:
        data = np.stack([data, self.fun(np.arange(2048) + (rotation - 300000) * 1044.5 / 5000)], 0)
    else:
        data = np.stack([data, self.fun(np.arange(2048) + (rotation - 10000) * 1039.67 / 5000)], 0)

    return data</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.display_data"><code class="name flex">
<span>def <span class="ident">display_data</span></span>(<span>self, data, xlimit=None, ylimit=None, disp=True)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def display_data(self, data, xlimit=None, ylimit=None, disp=True):
    if not xlimit:
        x = data[1]
        y = data[0]
    else:
        n = self.idx_of_the_nearest(data[1], xlimit)
        x = data[1][n[1] : n[0]]
        y = data[0][n[1] : n[0]]

    if disp:
        # xdivision = 200
        akmp.font_setup(size=28)
        fig = plt.figure(figsize=(16, 9), dpi=50)
        ax = fig.add_subplot(
            1,
            1,
            1,
            xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
            ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
        )
        ax.plot(data[1], data[0], &#34;.-&#34;)
        # ax.legend(bbox_to_anchor=(1, 1), loc=&#39;upper right&#39;, borderaxespad=0, fontsize=28)
        # ax.xaxis.set_major_locator(mpl.ticker.MultipleLocator(xdivision))
        ax.yaxis.set_major_formatter(
            mpl.ticker.PercentFormatter((max(y) - (min(y))) * 100, decimals=1, symbol=&#34;&#34;)
        )
        akmp.ticks_visual(ax)
        akmp.grid_visual(ax)
        if xlimit:
            plt.xlim(xlimit)
        if ylimit:
            plt.ylim(ylimit)
        else:
            plt.ylim((min(y)), (max(y) * 1.1))

    return data</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.display_gaussian"><code class="name flex">
<span>def <span class="ident">display_gaussian</span></span>(<span>self, data, out, rangeis, xlimit=None, ylimit=None, num_gauss=1, subplot=None, fig=None, fontsize=28)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def display_gaussian(
    self, data, out, rangeis, xlimit=None, ylimit=None, num_gauss=1, subplot=None, fig=None, fontsize=28
):
    x2 = np.linspace(data[1][0], data[1][-1], 10000)
    n = self.idx_of_the_nearest(data[1], rangeis)
    x = data[1][n[1] : n[0]]
    y = data[0][n[1] : n[0]]

    akmp.font_setup(size=fontsize)
    if subplot:
        ax = fig.add_subplot(
            subplot[0],
            subplot[1],
            subplot[2],
            xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
            ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
        )
    else:
        fig = plt.figure(figsize=(16, 9), dpi=50)
        ax = fig.add_subplot(
            1,
            1,
            1,
            xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
            ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
        )
    ax.plot(data[1], data[0] - out.best_values[&#34;c&#34;], &#34;o&#34;, label=r&#34;Data&#34;, c=&#34;k&#34;)
    if num_gauss == 1:
        ax.plot(
            x2,
            self.gaussian(
                x2, out.best_values[&#34;amplitude&#34;], out.best_values[&#34;center&#34;], out.best_values[&#34;sigma&#34;]
            ),
            &#34;-&#34;,
            label=r&#34;Fitting&#34;,
            c=&#34;r&#34;,
        )
    elif num_gauss == 2:
        ax.plot(
            x2,
            self.gaussian(
                x2,
                out.best_values[&#34;gauss1_amplitude&#34;],
                out.best_values[&#34;gauss1_center&#34;],
                out.best_values[&#34;gauss1_sigma&#34;],
            ),
            &#34;-&#34;,
            label=r&#34;Low temperature&#34;,
            c=&#34;C1&#34;,
        )
        ax.plot(
            x2,
            self.gaussian(
                x2,
                out.best_values[&#34;gauss2_amplitude&#34;],
                out.best_values[&#34;gauss2_center&#34;],
                out.best_values[&#34;gauss2_sigma&#34;],
            ),
            &#34;-&#34;,
            label=r&#34;High temperature&#34;,
            c=&#34;C2&#34;,
        )
        ax.plot(
            x2,
            self.gaussian(
                x2,
                out.best_values[&#34;gauss1_amplitude&#34;],
                out.best_values[&#34;gauss1_center&#34;],
                out.best_values[&#34;gauss1_sigma&#34;],
            )
            + self.gaussian(
                x2,
                out.best_values[&#34;gauss2_amplitude&#34;],
                out.best_values[&#34;gauss2_center&#34;],
                out.best_values[&#34;gauss2_sigma&#34;],
            ),
            &#34;-&#34;,
            label=r&#34;Summation&#34;,
            c=&#34;r&#34;,
        )
    ax.legend(bbox_to_anchor=(1, 1), loc=&#34;upper right&#34;, borderaxespad=0)
    ax.xaxis.set_major_locator(mpl.ticker.LinearLocator(3))
    ax.yaxis.set_major_formatter(
        mpl.ticker.PercentFormatter((max(y) - out.best_values[&#34;c&#34;]) * 100, decimals=1, symbol=&#34;&#34;)
    )
    akmp.ticks_visual(ax)
    akmp.grid_visual(ax)
    if xlimit:
        plt.xlim(xlimit)
    if ylimit:
        plt.ylim(ylimit)
    else:
        plt.ylim((min(y)) - out.best_values[&#34;c&#34;], (max(y) - out.best_values[&#34;c&#34;]) * 1.1)</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.display_nc"><code class="name flex">
<span>def <span class="ident">display_nc</span></span>(<span>self, fp, xlim=None, ylim=None, disp=True, subplot=None, fig=None, style=False, yoffset=None, title=None, line=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def display_nc(
    self,
    fp,
    xlim=None,
    ylim=None,
    disp=True,
    subplot=None,
    fig=None,
    style=False,
    yoffset=None,
    title=None,
    line=None,
):
    if type(fp) == str:  # when row nc data is selected
        data = self.convert_nc(fp)
    elif type(fp) != np.ndarray:
        return &#39;please insert fp=&#34;row nc data&#34; or data=&#34;converted nc data&#34;&#39;
    else:
        data = fp
    akmp.font_setup(size=28)
    if disp:
        if subplot:
            ax = fig.add_subplot(
                subplot[0], subplot[1], subplot[2], xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;
            )
        else:
            fig = plt.figure(figsize=(16, 9), dpi=50)
            ax = fig.add_subplot(1, 1, 1, xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;)
        if line:
            ax.axvline(line, c=&#34;r&#34;)
        if style:
            a = r&#34;${\rm Intensity}{\ }{\rm (\times 10^&#34;
            b = f&#34;{yoffset}&#34;
            c = r&#34;{\ }arb.unit)}$&#34;
            ax.set_ylabel(a + b + c)
            ax.set_ylabel(r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;)
            ax.yaxis.offsetText.set_fontsize(0)
            ax.plot(data[1], data[0] / max(data[0]), &#34;.-&#34;, c=&#34;k&#34;)
        else:
            ax.set_ylabel(r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;)
            ax.plot(data[1], data[0], &#34;.-&#34;, c=&#34;k&#34;)
            ax.set_ylim(top=max(data[0]) * 1.2)

        ax.set_title(title)
        # ax.legend(bbox_to_anchor=(1, 1), loc=&#39;upper right&#39;, borderaxespad=0, fontsize=16)
        akmp.ticks_visual(ax)
        akmp.grid_visual(ax)
        if xlim:
            ax.set_xlim(xlim)
        if ylim:
            ax.set_ylim(ylim)</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.gaussian"><code class="name flex">
<span>def <span class="ident">gaussian</span></span>(<span>self, x, amp, cen, wid)</span>
</code></dt>
<dd>
<div class="desc"><p>1-d gaussian: gaussian(x, amp, cen, wid)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def gaussian(self, x, amp, cen, wid):
    &#34;&#34;&#34;1-d gaussian: gaussian(x, amp, cen, wid)&#34;&#34;&#34;
    return (amp / (np.sqrt(2 * np.pi) * wid)) * np.exp(-((x - cen) ** 2) / (2 * wid ** 2))</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.get_rot"><code class="name flex">
<span>def <span class="ident">get_rot</span></span>(<span>self, fp)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_rot(self, fp):
    if iscd(fp):
        return int(fp.split(&#34;-&#34;)[1])
    elif exists(fp):
        split = &#34;\\&#34;
        if len(fp.split(split)) == 1:
            split = &#34;/&#34;
        return int(fp.split(split)[-1].split(&#34;-&#34;)[1])
    else:
        print(&#34;File does not exist&#34;)
        return</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.idx_of_the_nearest"><code class="name flex">
<span>def <span class="ident">idx_of_the_nearest</span></span>(<span>self, data, value)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def idx_of_the_nearest(self, data, value):
    if type(value) == float:
        idx = np.argmin(np.abs(np.array(data) - value))
        # print(np.abs(np.array(data) - value))
        return idx
    if type(value) == list:
        idx = [None] * len(value)
        for i in range(len(value)):
            idx[i] = np.argmin(np.abs(np.array(data) - value[i]))
            # idx[i] = [value[i], np.argmin(np.abs(np.array(data) - value[i]))] #としてもよい
            # print(np.abs(np.array(data) - value[i]))
        return idx</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.rotationis"><code class="name flex">
<span>def <span class="ident">rotationis</span></span>(<span>self, rotation)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def rotationis(self, rotation):
    if self.old:
        if rotation == 400000:
            wavelength = self.balmers[0]
        elif rotation == 585000:
            wavelength = self.balmers[1]
        elif rotation == 635000:
            wavelength = self.balmers[2]
        else:
            wavelength = 0
    else:
        if rotation == 415000:
            wavelength = self.balmers[0]
        elif rotation == 600000:
            wavelength = self.balmers[1]
        elif rotation == 650000:
            wavelength = self.balmers[2]
        else:
            wavelength = 0

    return wavelength</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.sub_bg"><code class="name flex">
<span>def <span class="ident">sub_bg</span></span>(<span>self, fp, bgpath)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def sub_bg(self, fp, bgpath):
    import os

    rot = fp.split(&#34;-&#34;)[1]
    op = fp.split(&#34;-&#34;)[4]
    ls = [i for i in os.listdir(bgpath) if rot in i]
    ls = [i for i in ls if &#34;-&#34; + op + &#34;-&#34; in i]
    if ls == []:
        ls = [os.listdir(bgpath)]
    return self.subtract_background(fp, disp=False, bp=os.path.join(bgpath, ls[0]))

    # def display_nc(self, name, xlimit=0, ylimit=0, disp=0, topng=False, topdf=False):
    import re
    from os.path import join

    numbers = re.findall(r&#34;\d+&#34;, name)
    rotation_number = []
    for i in range(len(numbers)):
        if int(numbers[i]) // 5000 != 0:
            rotation_number.append(numbers[i])
    self.rotationis(rotation_number[0])

    fp = join(self.bpath, name)
    data = np.array(xr.open_dataset(fp).to_array()[0].sum(axis=0)).astype(np.float64)
    data = np.stack([data, self.fun(np.arange(2048) + (self.rotation - 300000) * 1044.5 / 5000)], 0)
    if xlimit == 0:
        x = data[1]
        y = data[0]
    else:
        n = self.idx_of_the_nearest(data[1], xlimit)
        x = data[1][n[1] : n[0]]
        y = data[0][n[1] : n[0]]

    if disp == 0:
        # xdivision = 200
        font_setup(size=28)
        fig = plt.figure(figsize=(16, 9), dpi=50)
        ax = fig.add_subplot(
            1,
            1,
            1,
            xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
            ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
        )
        ax.plot(data[1], data[0], &#34;.-&#34;, label=name)
        ax.legend(bbox_to_anchor=(1, 1), loc=&#34;upper right&#34;, borderaxespad=0, fontsize=16)
        # ax.xaxis.set_major_locator(mpl.ticker.MultipleLocator(xdivision))
        # ax.yaxis.set_major_formatter(mpl.ticker.PercentFormatter((max(y) - (min(y)))*100, decimals=1, symbol=&#39;&#39;))
        ticks_visual(ax)
        grid_visual(ax)
        if xlimit != 0:
            plt.xlim(xlimit)
        if ylimit != 0:
            plt.ylim(ylimit)
        else:
            # plt.ylim((min(y)), (max(y) * 1.1))
            pass

        if topng:
            fig.savefig(join(self.ppath, &#34;&#34;))

    return data

    # def display_nc_all(self):
    from re import findall
    from os import listdir

    files = listdir(self.bpath)
    for file_name in files:
        numbers = findall(r&#34;\d+&#34;, file_name)
        rotation_number = []
        for i in range(len(numbers)):
            if int(numbers[i]) // 5000 != 0:
                rotation_number.append(numbers[i])
        self.rotationis(rotation_number[0])
        self.display_nc(file_name)</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.subtract_background"><code class="name flex">
<span>def <span class="ident">subtract_background</span></span>(<span>self, fp, disp=True, bp=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def subtract_background(self, fp, disp=True, bp=None):
    split = &#34;\\&#34;
    from os.path import join

    if not bp:
        bp = join(&#34;../../data/spectrometer/20211208&#34;, &#34;background-420000-10000.0ms-.nc&#34;)
    image = self.convert_nc(fp)
    back = self.convert_nc(bp)
    sub = image
    for i in range(len(image[0])):
        sub[0][i] = image[0][i] - back[0][i]
    if disp:
        fig = plt.figure(figsize=(16, 9), dpi=50)
        ax = fig.add_subplot(
            1,
            1,
            1,
            xlabel=r&#34;${\rm Wavelength}{\ }{\rm (nm)}$&#34;,
            ylabel=r&#34;${\rm Intensity}{\ }{\rm (arb.unit)}$&#34;,
        )
        ax.plot(sub[1], sub[0], &#34;.-&#34;)
        # ax.legend(bbox_to_anchor=(1, 1), loc=&#39;upper right&#39;, borderaxespad=0, fontsize=16)
        akmp.ticks_visual(ax)
        akmp.grid_visual(ax)
    return sub</code></pre>
</details>
</dd>
<dt id="aklab.specparser.Spectrometer.subtract_nc"><code class="name flex">
<span>def <span class="ident">subtract_nc</span></span>(<span>self, name1, name2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def subtract_nc(self, name1, name2):
    data_back = self.convert_nc(name2)
    data_sig = self.convert_nc(name1)

    for i in range(len(data_sig[0])):
        data_sig[0][i] = data_sig[0][i] - data_back[0][i]

    return data_sig</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="aklab" href="index.html">aklab</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="aklab.specparser.iscd" href="#aklab.specparser.iscd">iscd</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="aklab.specparser.Spectrometer" href="#aklab.specparser.Spectrometer">Spectrometer</a></code></h4>
<ul class="two-column">
<li><code><a title="aklab.specparser.Spectrometer.calc_fwhm" href="#aklab.specparser.Spectrometer.calc_fwhm">calc_fwhm</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.calc_temperature" href="#aklab.specparser.Spectrometer.calc_temperature">calc_temperature</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.calcgauss" href="#aklab.specparser.Spectrometer.calcgauss">calcgauss</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.convert_nc" href="#aklab.specparser.Spectrometer.convert_nc">convert_nc</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.display_data" href="#aklab.specparser.Spectrometer.display_data">display_data</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.display_gaussian" href="#aklab.specparser.Spectrometer.display_gaussian">display_gaussian</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.display_nc" href="#aklab.specparser.Spectrometer.display_nc">display_nc</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.gaussian" href="#aklab.specparser.Spectrometer.gaussian">gaussian</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.get_rot" href="#aklab.specparser.Spectrometer.get_rot">get_rot</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.idx_of_the_nearest" href="#aklab.specparser.Spectrometer.idx_of_the_nearest">idx_of_the_nearest</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.rotationis" href="#aklab.specparser.Spectrometer.rotationis">rotationis</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.sub_bg" href="#aklab.specparser.Spectrometer.sub_bg">sub_bg</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.subtract_background" href="#aklab.specparser.Spectrometer.subtract_background">subtract_background</a></code></li>
<li><code><a title="aklab.specparser.Spectrometer.subtract_nc" href="#aklab.specparser.Spectrometer.subtract_nc">subtract_nc</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>